// [nucleo]  Build version: 1.0.7 - Thursday, June 13th, 2019, 10:43:55 AM
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e){e.exports={name:"nucleo",description:"Game manager for Playable ads",version:"1.0.7",keywords:[],author:"ironSource",license:"ISC",main:"./dist/nucleo.js",types:"./typings/nucleo.d.ts",scripts:{test:"jest",lint:"tslint --project ./",start:"webpack --mode development --watch",build:"npm run test && npm run build:dev && npm run build:min && npm run readme","build:dev":"webpack --mode development","build:min":"webpack --mode production",readme:"node ./scripts/update-readme.js",upload:"./scripts/upload.sh"},dependencies:{},devDependencies:{"@types/jest":"^24.0.13",jest:"^24.8.0","ts-jest":"^24.0.2","ts-loader":"^6.0.1",tslint:"^5.16.0","tslint-consistent-codestyle":"^1.15.1","tslint-defocus":"^2.0.6","tslint-eslint-rules":"^5.4.0","tslint-origin-ordered-imports-rule":"^1.2.2",typescript:"^3.4.5","uglifyjs-webpack-plugin":"^2.1.3",webpack:"^4.32.2","webpack-auto-inject-version":"^1.2.2","webpack-cli":"^3.3.2"}}},function(e,t,n){!function(t,n,r){"use strict";function o(e){e=e||{};var t="1.5.1",n="atom-js";this.options={endpoint:e.endpoint||"https://track.atom-data.io/",apiVersion:"V1",auth:e.auth||"",sdkVersion:e.sdkVersion?t+"+"+e.sdkVersion:t,sdkType:e.sdkType?n+"+"+e.sdkType:n}}function i(e){if(this.params=e||{},"string"!=typeof e.data&&!(e.data instanceof String))try{this.params.data=JSON.stringify(this.params.data)}catch(e){throw new Error("data is invalid - can't be stringified")}this.headers={contentType:"application/json;charset=UTF-8",sdkType:this.params.sdkType,sdkVersion:this.params.sdkVersion},"XDomainRequest"in t&&null!==t.XDomainRequest&&this._isIE()&&this._isIE()<10?(this.params.endpoint=this.params.endpoint.replace(/^(http|https):/,location.protocol),this.xhr=new XDomainRequest,this.oldBrowser=!0):(this.xhr=new XMLHttpRequest,this.oldBrowser=!1)}function a(e,t,n){this.error=e,this.response=t,this.status=n}function s(e){var t=this;this.retryTimeout=1e3,e=e||{},this.params=e,this.params.flushInterval=e.flushInterval?1e3*e.flushInterval:1e4,this.params.bulkLen=e.bulkLen?e.bulkLen:3,this.params.bulkSize=e.bulkSize?1024*e.bulkSize:10240,this.params.auth=e.auth?e.auth:"",this.accumulated={},this.atom=new o(e),this.timer||(this.timer=setInterval(function(){t.flush()},this.params.flushInterval))}function u(e,t){function n(e,n){e(function(e,i,a){if(r[n]={err:e,data:i,status:a},0==--o)return t(r)})}for(var r=[],o=e.length,i=0;i<e.length;i++)n(e[i],i)}(t.IronSourceAtom=o).prototype.putEvent=function(e,t){if(!(e=e||{}).stream)return t("Stream is required",null,400);if(!e.data)return t("Data is required",null,400);e.apiVersion=this.options.apiVersion,e.sdkVersion=this.options.sdkVersion,e.sdkType=this.options.sdkType,e.auth=e.auth||this.options.auth,e.endpoint=e.endpoint||this.options.endpoint;var n=new i(e);return e.method&&"GET"===e.method.toUpperCase()?n.get(t):n.post(t)},o.prototype.putEvents=function(e,t){return(e=e||{}).stream?e.data&&e.data instanceof Array&&e.data.length?e.method&&"GET"==e.method.toUpperCase()?t("GET is not a valid method for putEvents",null,400):(e.apiVersion=this.options.apiVersion,e.auth=this.options.auth,e.sdkVersion=this.options.sdkVersion,e.sdkType=this.options.sdkType,e.endpoint=this.options.endpoint+"bulk",new i(e).post(t)):t("Data (must be not empty array) is required",null,400):t("Stream is required",null,400)},o.prototype.health=function(e){return new i(this.options).health(e)},e.exports&&(e.exports={IronSourceAtom:o,Request:i,Response:a,Tracker:s,taskMap:u}),i.prototype._isIE=function(){var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("msie")&&parseInt(e.split("msie")[1])},i.prototype.post=function(e){if(!this.params.stream||!this.params.data)return e("Stream and Data fields are required",null,400);var t=JSON.stringify({data:this.params.data,table:this.params.stream,apiVersion:this.params.apiVersion,auth:this.params.auth?C.HmacSHA256(this.params.data,this.params.auth).toString(C.enc.Hex):""});this._sendRequest(t,"POST",e)},i.prototype.get=function(e){if(!this.params.stream||!this.params.data)return e("Stream and Data fields are required",null,null);var t,n=JSON.stringify({table:this.params.stream,data:this.params.data,apiVersion:this.params.apiVersion,auth:this.params.auth?C.HmacSHA256(this.params.data,this.params.auth).toString(C.enc.Hex):""});try{t=O.encode(n)}catch(e){throw new Error("Can't encode Base64 data: "+e)}this._sendRequest(t,"GET",e)},i.prototype.health=function(e){this._sendRequest("health","GET",e)},i.prototype._sendRequest=function(e,t,n){var r,o=this.xhr,i="health"==e?this.params.endpoint+"health":this.params.endpoint+"?data="+e;this.oldBrowser?(o.open(t,this.params.endpoint),o.onload=function(){r=new a(null,o.responseText,200),n(null,r.data(),r.status)},o.onprogress=function(){},o.ontimeout=function(){r=new a("No connection to server",null,500),n(r.err(),null,r.status)},o.onerror=function(){r=new a("Service Unavailable",null,500),n(r.err(),null,r.status)},"POST"===t?(o.open("POST",this.params.endpoint),o.send(e)):(o.open("GET",i),o.send())):(o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&(200==o.status?(r=new a(null,o.response,o.status),n(null,r.data(),r.status)):400<=o.status&&o.status<600?(r=new a(o.response,null,o.status),n(r.err(),null,r.status)):0==o.status&&(r=new a("No connection to server",null,500),n(r.err(),null,500)))},"POST"===t?(o.open("POST",this.params.endpoint,!0),this._setRequestHeaders(),o.send(e)):(o.open("GET",i,!0),this._setRequestHeaders(),o.send()))},i.prototype._setRequestHeaders=function(){this.xhr.setRequestHeader("Content-type",this.headers.contentType),this.xhr.setRequestHeader("x-ironsource-atom-sdk-type",this.headers.sdkType),this.xhr.setRequestHeader("x-ironsource-atom-sdk-version",this.headers.sdkVersion)},a.prototype.data=function(){if(this.error)return null;try{return JSON.parse(this.response)}catch(e){return this.response}},a.prototype.err=function(){try{return JSON.parse(this.error)}catch(e){return this.error}},(t.IronSourceAtom.Tracker=s).prototype.track=function(e,t){var n=this;if(e===r||0==e.length||0==t.length||t===r)throw new Error("Stream name and data are required parameters");if(e in n.accumulated||(n.accumulated[e]=[]),"string"==typeof t||t instanceof String)n.accumulated[e].push(t);else try{n.accumulated[e].push(JSON.stringify(t))}catch(e){throw new Error("Invalid Data - can't be stringified",e)}(n.accumulated[e].length>=n.params.bulkLen||function(e){return encodeURI(e).split(/%..|./).length-1}(n.accumulated[e])>=n.params.bulkSize)&&n.flush(e)},s.prototype.flush=function(e,t){function n(e,t,o,i,a){return a&&(r.accumulated[e]=[],a=!1),r.atom.putEvents({stream:e,data:t},function(r,s,u){return null!=r&&500<=u?o<12e5?void setTimeout(function(){o=2*o+Math.floor(1e3*Math.random()+100),n(e,t,o,i,a)},o):i("Timeout - No response from server",null,408):i(r,s,u)})}var r=this,o=this.retryTimeout;t||(t=function(e,t){return e?new Error(e):t});var i=[];if(e)1<=r.accumulated[e].length&&i.push(function(t){n(e,r.accumulated[e],o,t,!0)});else for(var a in r.accumulated)1<=r.accumulated[a].length&&function(e){i.push(function(t){return n(e,r.accumulated[e],o,t,!0)})}(a);return u(i,t)};var p,d,c,l,h,f,m,v,g,y,w,S,b,E,C=C||(p=Math,c=(d={}).lib={},l=c.Base={extend:function(e){I.prototype=this;var t=new I;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},h=c.WordArray=l.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||m).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,o=e.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var a=n[i>>>2]>>>24-i%4*8&255;t[r+i>>>2]|=a<<24-(r+i)%4*8}else for(i=0;i<o;i+=4)t[r+i>>>2]=n[i>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=p.ceil(t/4)},clone:function(){var e=l.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t,n=[],r=function(e){e=e;var t=987654321,n=4294967295;return function(){var r=((t=36969*(65535&t)+(t>>16)&n)<<16)+(e=18e3*(65535&e)+(e>>16)&n)&n;return r/=4294967296,(r+=.5)*(.5<p.random()?1:-1)}},o=0;o<e;o+=4){var i=r(4294967296*(t||p.random()));t=987654071*i(),n.push(4294967296*i()|0)}return new h.init(n,e)}}),f=d.enc={},m=f.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new h.init(n,t/2)}},v=f.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new h.init(n,t)}},g=f.Utf8={stringify:function(e){try{return decodeURIComponent(escape(v.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return v.parse(unescape(encodeURIComponent(e)))}},y=c.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=g.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,r=t.sigBytes,o=this.blockSize,i=r/(4*o),a=(i=e?p.ceil(i):p.max((0|i)-this._minBufferSize,0))*o,s=p.min(4*a,r);if(a){for(var u=0;u<a;u+=o)this._doProcessBlock(n,u);var d=n.splice(0,a);t.sigBytes-=s}return new h.init(d,s)},clone:function(){var e=l.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),c.Hasher=y.extend({cfg:l.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){y.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new w.HMAC.init(e,n).finalize(t)}}}),w=d.algo={},d);function I(){}!function(e){var t=C,n=t.lib,r=n.WordArray,o=n.Hasher,i=t.algo,a=[],s=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,o=0;o<64;)t(r)&&(o<8&&(a[o]=n(e.pow(r,.5))),s[o]=n(e.pow(r,1/3)),o++),r++}();var u=[],p=i.SHA256=o.extend({_doReset:function(){this._hash=new r.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],a=n[3],p=n[4],d=n[5],c=n[6],l=n[7],h=0;h<64;h++){if(h<16)u[h]=0|e[t+h];else{var f=u[h-15],m=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,v=u[h-2],g=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;u[h]=m+u[h-7]+g+u[h-16]}var y=r&o^r&i^o&i,w=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),S=l+((p<<26|p>>>6)^(p<<21|p>>>11)^(p<<7|p>>>25))+(p&d^~p&c)+s[h]+u[h];l=c,c=d,d=p,p=a+S|0,a=i,i=o,o=r,r=S+(w+y)|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+a|0,n[4]=n[4]+p|0,n[5]=n[5]+d|0,n[6]=n[6]+c|0,n[7]=n[7]+l|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(64+o>>>9<<4)]=e.floor(r/4294967296),n[15+(64+o>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(p),t.HmacSHA256=o._createHmacHelper(p)}(Math),b=(S=C).lib.Base,E=S.enc.Utf8,S.algo.HMAC=b.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=E.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),i=this._iKey=t.clone(),a=o.words,s=i.words,u=0;u<n;u++)a[u]^=1549556828,s[u]^=909522486;o.sigBytes=i.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}}),t.ironSourceAtomInit=t.ironSourceAtomInit||function(){},t.ironSourceAtomInit();var O={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,r,o,i,a,s,u="",p=0;for(e=O._utf8_encode(e);p<e.length;)o=(t=e.charCodeAt(p++))>>2,i=(3&t)<<4|(n=e.charCodeAt(p++))>>4,a=(15&n)<<2|(r=e.charCodeAt(p++))>>6,s=63&r,isNaN(n)?a=s=64:isNaN(r)&&(s=64),u=u+this._keyStr.charAt(o)+this._keyStr.charAt(i)+this._keyStr.charAt(a)+this._keyStr.charAt(s);return u},decode:function(e){var t,n,r,o,i,a,s="",u=0;for(e=e.replace(/[^A-Za-z0-9+\/=]/g,"");u<e.length;)t=this._keyStr.indexOf(e.charAt(u++))<<2|(o=this._keyStr.indexOf(e.charAt(u++)))>>4,n=(15&o)<<4|(i=this._keyStr.indexOf(e.charAt(u++)))>>2,r=(3&i)<<6|(a=this._keyStr.indexOf(e.charAt(u++))),s+=String.fromCharCode(t),64!=i&&(s+=String.fromCharCode(n)),64!=a&&(s+=String.fromCharCode(r));return O._utf8_decode(s)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):(127<r&&r<2048?t+=String.fromCharCode(r>>6|192):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128)),t+=String.fromCharCode(63&r|128))}return t},_utf8_decode:function(e){for(var t="",n=0,r=0,o=0,i=0;n<e.length;)(i=e.charCodeAt(n))<128?(t+=String.fromCharCode(i),n++):191<i&&i<224?(o=e.charCodeAt(n+1),t+=String.fromCharCode((31&i)<<6|63&o),n+=2):(o=e.charCodeAt(n+1),r=e.charCodeAt(n+2),t+=String.fromCharCode((15&i)<<12|(63&o)<<6|63&r),n+=3);return t}}}(window,document)},function(e,t,n){"use strict";n.r(t);var r=n(0),o={mode:"pa",title:"",version:"",nucleo:r.version,genre:"",type:"playable",userId:"no_user_id",localeName:"en",configName:"config1"},i={attempt:1,levelNumber:1,interactionCount:0};function a(){var e=window.location.search.substring(1).split("&"),t=window.URL_PARAMS||{};return e.forEach(function(e){var n=e.split("="),r=decodeURIComponent(n[1]),o=n[0],i=!1;-1!==o.indexOf("[]")&&(o=o.replace("[]",""),i=!0),void 0===t[o]?t[o]=i?[r]:r:i&&"string"==typeof t[o]?t[o]=[t[o],r]:i?t[o].push(r):t[o]=r}),t}var s=(u.prototype.on=function(e,t){return void 0===this.pool[e]&&(this.pool[e]=[]),this.pool[e].push(t),this},u.prototype.do=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return void 0!==this.pool[e]&&this.pool[e].forEach(function(e){return e.apply(void 0,t)}),this},u.prototype.list=function(){return Object.keys(this.pool)},u);function u(){this.pool={}}var p=new s,d=new s,c={pa:["eventId","eventType","eventName","eventTimestamp","title","version","nucleo","userId","language","bannerId","requestId","opportunityId","creativeId","channel","config","genre","sessionId","levelNumber","attempt"],iec:["eventId","eventType","eventName","eventTimestamp","type","title","version","nucleo","userId","language","bannerId","requestId","opportunityId","creativeId","channel","sessionId"]},l={pa:{impression:{type:"Started",name:"Impression"},loading:{type:"Loading",name:"Loading"},gameStarted:{type:"GameStarted",name:"GameStarted"},focusExit:{type:"Focus",name:"Exit"},focusRestore:{type:"Focus",name:"Restore"},tutorial:{type:"Tutorial",name:"Tutorial"},progressMidway:{type:"Progress",name:"Midway"},progressStartLevel:{type:"Progress",name:"StartLevel"},progressEndLevel:{type:"Progress",name:"EndLevel"},progressTryAgain:{type:"Progress",name:"TryAgain"},adOverWin:{type:"AdOver",name:"Win"},adOverLose:{type:"AdOver",name:"Lose"},adOverTimer:{type:"AdOver",name:"Timer"},adOverFake:{type:"AdOver",name:"Fake"},convertIntro:null,convertGame:{type:"Convert",name:"Game"},convertEndLevel:{type:"Convert",name:"EndLevel"},convertEndGameWin:{type:"Convert",name:"EndGameWin"},convertEndGameLose:{type:"Convert",name:"EndGameLose"},convertEndGameTimer:{type:"Convert",name:"EndGameTimer"},convertEndGameFake:{type:"Convert",name:"EndGameFake"}},iec:{impression:{type:"started",name:"impression"},loading:null,gameStarted:null,focusExit:{type:"focus",name:"exit"},focusRestore:{type:"focus",name:"restore"},tutorial:{type:"interaction",name:"tutorial"},progressMidway:null,progressStartLevel:null,progressEndLevel:null,progressTryAgain:null,adOverWin:{type:"ad over",name:"ad over"},adOverLose:{type:"ad over",name:"ad over"},adOverTimer:{type:"ad over",name:"ad over"},adOverFake:{type:"ad over",name:"ad over"},convertIntro:{type:"convert",name:"from intro"},convertGame:{type:"convert",name:"from game"},convertEndLevel:{type:"convert",name:"from game"},convertEndGameWin:{type:"convert",name:"from popup"},convertEndGameLose:{type:"convert",name:"from popup"},convertEndGameTimer:{type:"convert",name:"from popup"},convertEndGameFake:{type:"convert",name:"from auto"}}};n(1);var h=(f.prototype.init=function(e,t,n){this.name=e,this.mode=t,this.mapping=n,console.debug("[NUC:EVENT:%s] initializing...",e)},f.prototype.beforeSend=function(e){console.debug('[NUC:EVENT:%s] request: #%s "%s-%s" - %o',this.name,e.eventId,e.eventType,e.eventName,this.mapPayload(e))},f.prototype.afterSend=function(e,t){console.debug('[NUC:EVENT:%s] response: #%s "%s-%s" - %i',this.name,e.eventId,e.eventType,e.eventName,t)},f.prototype.mapPayload=function(e){var t=this,n={};return Object.keys(this.mapping).forEach(function(r){if("object"==typeof t.mapping[r]){var o=t.mapping[r],i=o.k,a=o.f;n[i]=a(e[r])}else n[t.mapping[r]]=e[r]}),n},f);function f(){this.mapping={}}var m,v,g=(m=function(e,t){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),y={endpoint:"https://track.atom-data.io/"};function w(){var e=null!==v&&v.apply(this,arguments)||this;return e.atomMapping={eventId:"event_id",eventType:"event_type",eventName:"event_name",eventTimestamp:{k:"event_timestamp",f:function(e){return new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().slice(0,19).replace("T"," ")}},type:"type",title:"title",version:"version",nucleo:"nucleo",userId:"user_id",language:"language",bannerId:"banner_id",requestId:"request_id",opportunityId:"opportunity_id",creativeId:"creative_id",channel:"channel",config:"config",genre:"genre",sessionId:"session_id",levelNumber:"level_number",attempt:"attempt"},e.streams={pa:"is.innovation_studio_playable",iec:"is.innovation_studio_iec"},e}var S={atom:(g(w,v=h),w.prototype.init=function(e){v.prototype.init.call(this,"ATOM",e,this.atomMapping),this.ironsourceAtom=new IronSourceAtom(y),this.ironsourceAtom||console.error("[NUC:EVENT:ATOM] instance is undefined"),this.streams[e]||console.error('[NUC:EVENT:ATOM] Can\'t find stream for mode "%s"',e)},w.prototype.send=function(e){var t=this;"iec"===this.mode&&(e.title=e.title.toLowerCase()),this.beforeSend(e),this.ironsourceAtom.putEvent({stream:this.streams[this.mode],data:this.mapPayload(e)},function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t.afterSend(e,n[2])})},w)},b=function(){return(b=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function E(){this.eventId=0}var C=new(E.prototype.init=function(e,t){this.eventFunnel=function(e){return l[e]}(t.mode),this.eventFieldset=function(e){return c[e]}(t.mode),this.eventProviders=e.map(function(e){return function(e,t){var n=new S[t];return n.init(e),n}(t.mode,e)}),this.basePayload={title:t.title,version:function(e){var t=e.split(".");return parseInt(t[0]+(1<t[1].length?t[1]:"0"+t[1]),10)}(t.version),nucleo:t.nucleo,userId:t.userId,type:t.type,language:t.localeName,config:parseInt(t.configName.replace("config","")),genre:t.genre,sessionId:this.generateSessionId()}},E.prototype.updateBasePayload=function(e){this.basePayload=b({},this.basePayload,e)},E.prototype.sendEvent=function(e,t){var n=this,r=this.eventFunnel[e];r&&this.eventProviders.forEach(function(e){return e.send(n.getPayload(r.type,r.name,t))})},E.prototype.sendCustomEvent=function(e,t,n){var r=this;this.eventProviders.forEach(function(o){return o.send(r.getPayload(e,t,n))})},E.prototype.getPayload=function(e,t,n){var r=b({},this.basePayload,{eventId:++this.eventId,eventTimestamp:new Date,eventType:e,eventName:t},n),o={};return this.eventFieldset.forEach(function(e){o[e]=r[e]}),o},E.prototype.generateSessionId=function(){return Math.floor(Date.now().valueOf()+3e14*Math.random())},E);function I(){console.debug("[NUC:PROTOCOL:DEMO] Initializing...")}function O(){console.debug("[NUC:PROTOCOL:DAPI] Initializing...");var e=document.createElement("script");e.async=!0,e.appendChild(document.createTextNode('function getScript(e,i){var n=document.createElement("script");n.type="text/javascript",n.async=!0,i&&(n.onload=i),n.src=e,document.head.appendChild(n)}function parseMessage(e){var i=e.data,n=i.indexOf(DOLLAR_PREFIX+RECEIVE_MSG_PREFIX);if(-1!==n){var t=i.slice(n+2);return getMessageParams(t)}return{}}function getMessageParams(e){var i,n=[],t=e.split("/"),a=t.length;if(-1===e.indexOf(RECEIVE_MSG_PREFIX)){if(a>=2&&a%2===0)for(i=0;a>i;i+=2)n[t[i]]=t.length<i+1?null:decodeURIComponent(t[i+1])}else{var o=e.split(RECEIVE_MSG_PREFIX);void 0!==o[1]&&(n=JSON&&JSON.parse(o[1]))}return n}function getDapi(e){var i=parseMessage(e);if(!i||i.name===GET_DAPI_URL_MSG_NAME){var n=i.data;getScript(n,onDapiReceived)}}function invokeDapiListeners(){for(var e in dapiEventsPool)dapiEventsPool.hasOwnProperty(e)&&dapi.addEventListener(e,dapiEventsPool[e])}function onDapiReceived(){dapi=window.dapi,window.removeEventListener("message",getDapi),invokeDapiListeners()}function init(){window.dapi.isDemoDapi&&(window.parent.postMessage(DOLLAR_PREFIX+SEND_MSG_PREFIX+JSON.stringify({state:"getDapiUrl"}),"*"),window.addEventListener("message",getDapi,!1))}var DOLLAR_PREFIX="$$",RECEIVE_MSG_PREFIX="DAPI_SERVICE:",SEND_MSG_PREFIX="DAPI_AD:",GET_DAPI_URL_MSG_NAME="connection.getDapiUrl",dapiEventsPool={},dapi=window.dapi||{isReady:function(){return!1},addEventListener:function(e,i){dapiEventsPool[e]=i},removeEventListener:function(e){delete dapiEventsPool[e]},isDemoDapi:!0};init();')),document.head.appendChild(e)}var _={demo:(I.prototype.triggerEvent=function(e){console.debug("[NUC:PROTOCOL:DEMO] Trigger event: %s",e)},I.prototype.onReady=function(e){e()},I.prototype.onViewableChange=function(e){e()},I.prototype.onResize=function(e){var t=this;window.addEventListener("resize",function(){return e(t.getScreenSize())},!1)},I.prototype.onAudioVolumeChange=function(e){e()},I.prototype.isReady=function(){return!0},I.prototype.isViewable=function(){return!0},I.prototype.getScreenSize=function(){return{width:window.innerWidth,height:window.innerHeight}},I.prototype.getAdData=function(){return{opportunityId:"",requestId:"",bannerId:"",creativeId:"",campaignId:"",productType:"rv"}},I.prototype.getDeviceData=function(){return{os:navigator?navigator.platform:"",osVersion:navigator&&navigator.appVersion?navigator.appVersion.split(" ")[0]:"",deviceId:"",deviceLanguage:navigator&&(navigator.language||"").split("-")[0].toLowerCase()||"",apiLevel:""}},I.prototype.getAudioVolume=function(){return 100},I.prototype.open=function(e){e?console.debug("[NUC:PROTOCOL:DEMO] Opening URL: %s",e):console.debug("[NUC:PROTOCOL:DEMO] Opening store")},I),dapi:(O.prototype.triggerEvent=function(e){window.dapi.triggerEvent&&(console.debug("[NUC:PROTOCOL:DAPI] Trigger event: %s",e),window.dapi.triggerEvent(e))},O.prototype.onReady=function(e){window.dapi.addEventListener("ready",e)},O.prototype.onViewableChange=function(e){window.dapi.addEventListener("viewableChange",function(){return e(window.dapi.isViewable())})},O.prototype.onResize=function(e){window.dapi.addEventListener("adResized",e)},O.prototype.onAudioVolumeChange=function(e){window.dapi.addEventListener("audioVolumeChange",e)},O.prototype.isReady=function(){return window.dapi.isReady()},O.prototype.isViewable=function(){return!!window.dapi.isViewable&&window.dapi.isViewable()},O.prototype.getScreenSize=function(){return window.dapi.getScreenSize()},O.prototype.getAdData=function(){var e=window.dapi.getAdData()||{};return{opportunityId:e.opportunityId||"",requestId:e.requestId||"",bannerId:e.bannerId||"",creativeId:e.creativeId||"",campaignId:e.campaignId||"",productType:"interstitial"===(e.productType||"").toLowerCase()?"is":"rv"}},O.prototype.getDeviceData=function(){var e=window.dapi.getDeviceData()||{};return{os:e.os||"",osVersion:e.osVersion||"",deviceId:e.deviceId||"",deviceLanguage:(e.deviceLanguage||"").split("-")[0].toLowerCase()||"",apiLevel:e.apiLevel||""}},O.prototype.getAudioVolume=function(){return window.dapi.getAudioVolume()},O.prototype.open=function(e){e?(console.debug("[NUC:PROTOCOL:DAPI] Opening URL: %s",e),window.dapi.open(e)):(console.debug("[NUC:PROTOCOL:DAPI] Opening store"),window.dapi.openStoreUrl())},O)};function R(){}function T(){return P.protocol}var P=new(R.prototype.init=function(e){this.protocolInstance=function(e){return console.debug('[NUC:PROTOCOL] Init - "%s"',e),new _[e]}(e)},Object.defineProperty(R.prototype,"protocol",{get:function(){return this.protocolInstance},enumerable:!0,configurable:!0}),R),A="progress",k=!1,L=!1,D=function(){return null},N=function(e){D=e};function V(){}var G=new(V.prototype.ready=function(){D()},V.prototype.autoplay=function(){this.checkIsReady("autoplay()")&&(L=!0)},V.prototype.interaction=function(){this.checkIsReady("interaction()")&&(0===i.interactionCount&&(T().triggerEvent("interaction"),C.sendEvent("tutorial",i)),i.interactionCount++)},V.prototype.startLevel=function(){this.checkIsReady("startLevel()")&&("endLevel"===A&&i.levelNumber++,"endLevel"!==A&&"tryAgain"!==A||(A="progress",C.sendEvent("progressStartLevel",i)))},V.prototype.endLevel=function(){this.checkIsReady("endLevel()")&&(A="endLevel",C.sendEvent("progressEndLevel",i))},V.prototype.midwayProgress=function(){this.checkIsReady("midwayProgress()")&&C.sendEvent("progressMidway",i)},V.prototype.endGame=function(e){if(this.checkIsReady("endGame('"+e+"')")){var t=this.getEndGameEvent(e);A=t.state,C.sendEvent(t.funnel,i)}},V.prototype.tryAgain=function(){this.checkIsReady("tryAgain()")&&(C.sendEvent("progressTryAgain",i),i.attempt++,A="tryAgain")},V.prototype.convert=function(e){this.checkIsReady("convert("+(e||"")+")")&&(C.sendEvent(this.getConvertEventName(),i),T().open(e))},V.prototype.getEndGameEvent=function(e){return{win:{state:"endGameWin",funnel:"adOverWin"},lose:{state:"endGameLose",funnel:"adOverLose"},timer:{state:"endGameTimer",funnel:"adOverTimer"},fake:{state:"endGameFake",funnel:"adOverFake"}}[e]},V.prototype.getConvertEventName=function(){return{progress:i.interactionCount||L?"convertGame":"convertIntro",endLevel:"convertEndLevel",endGameWin:"convertEndGameWin",endGameLose:"convertEndGameLose",endGameTimer:"convertEndGameTimer",endGameFake:"convertEndGameFake"}[A]},V.prototype.checkIsReady=function(e){return!!k||(console.warn("[NUC:TRIGGER] You triggered trigger.%s before callback.onStart() was called",e),!1)},V);function U(){}var x=new(U.prototype.onImpression=function(e){d.on("impression",e)},U.prototype.onDeviceData=function(e){d.on("deviceData",e)},U.prototype.onStart=function(e){d.on("start",e)},U.prototype.onResize=function(e){d.on("resize",e)},U.prototype.onPause=function(e){d.on("pause",e)},U.prototype.onResume=function(e){d.on("resume",e)},U.prototype.onMute=function(e){d.on("mute",e)},U.prototype.onUnmute=function(e){d.on("unmute",e)},U),M=function(){return(M=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},z=["atom"];function j(){var e=this;this.currentState={width:0,height:0,visible:!1},this.timestamp={nucleoStarted:(new Date).getTime(),protocolReady:0,firstVisible:0,gameReadyToStart:0,gameStarted:0},console.info("[NUC:CORE] Nucleo started! Version: %s",r.version),P.init(a().demo?"demo":"dapi"),N(function(){return e.playableReady()})}var q=new(j.prototype.init=function(e,t,n,r){var i=this;o.mode=e,o.title=t,o.genre=n,o.version=r,o.configName=a().config||"config1",o.localeName=a().lang||"en",C.init(z,o),T().isReady()?(console.debug("[NUC:CORE] Protocol already loaded"),this.onProtocolReady()):(console.debug("[NUC:CORE] Waiting for protocol"),T().onReady(function(){return i.onProtocolReady()})),console.debug("[NUC:CORE] Initialized: %o",o)},j.prototype.tryStart=function(){T().isViewable()&&this.timestamp.gameReadyToStart&&!this.timestamp.gameStarted&&(k=!0,this.timestamp.gameStarted=(new Date).getTime(),console.debug("[NUC:CORE] Start:\nProtocol ready: %sms\nFirst visible: %sms\nGame ready: %sms\nGame started: %sms",this.timestamp.protocolReady-this.timestamp.nucleoStarted,this.timestamp.firstVisible-this.timestamp.nucleoStarted,this.timestamp.gameReadyToStart-this.timestamp.nucleoStarted,this.timestamp.gameStarted-this.timestamp.nucleoStarted),function(){var e=T().getScreenSize(),t=e.width,n=e.height,r=0===T().getAudioVolume();d.do("start",t,n,r)}(),this.timestamp.gameReadyToStart>this.timestamp.firstVisible&&C.sendEvent("loading",M({},i,{eventTimestamp:new Date(this.timestamp.gameReadyToStart)})),C.sendEvent("gameStarted",i))},j.prototype.fetchAdData=function(){var e=T().getAdData();return{bannerId:e.bannerId,requestId:e.requestId,opportunityId:e.opportunityId,creativeId:e.creativeId,channel:e.productType.toUpperCase()}},j.prototype.onProtocolReady=function(){var e=this;console.debug("[NUC:CORE] Protocol ready"),d.do("deviceData",T().getDeviceData()),C.updateBasePayload(this.fetchAdData()),this.timestamp.protocolReady=(new Date).getTime(),T().onAudioVolumeChange(function(t){return e.onAudioVolumeChange(t)}),T().onViewableChange(function(t){return e.onViewableChange(t)}),T().onResize(function(t){var n=t.width,r=t.height;return e.onResize(n,r)}),T().isViewable()&&this.firstVisible(),this.tryStart()},j.prototype.onAudioVolumeChange=function(e){0<e?d.do("unmute"):d.do("mute")},j.prototype.onViewableChange=function(e){e&&!this.timestamp.gameStarted?(this.firstVisible(),this.tryStart()):e&&this.timestamp.gameStarted&&!this.currentState.visible?this.resume():!e&&this.timestamp.gameStarted&&this.currentState.visible&&this.pause(),this.currentState.visible=e},j.prototype.onResize=function(e,t){e===this.currentState.width&&t===this.currentState.height||(this.currentState.width=e,this.currentState.height=t,console.debug("[NUC:CORE] Resize: %ix%i",e,t),function(){var e=T().getScreenSize(),t=e.width,n=e.height;d.do("resize",t,n)}())},j.prototype.firstVisible=function(){this.timestamp.firstVisible||(console.debug("[NUC:CORE] First visible"),this.currentState.visible=!0,this.timestamp.firstVisible=(new Date).getTime(),function(){var e=T().getScreenSize(),t=e.width,n=e.height,r=0===T().getAudioVolume();d.do("impression",t,n,r)}(),C.sendEvent("impression",M({},i,{eventTimestamp:new Date(this.timestamp.firstVisible)})))},j.prototype.pause=function(){console.debug("[NUC:CORE] Pause"),C.sendEvent("focusExit",i),d.do("pause")},j.prototype.resume=function(){console.debug("[NUC:CORE] Resume"),C.sendEvent("focusRestore",i),d.do("resume")},j.prototype.playableReady=function(){console.debug("[NUC:CORE] Game ready"),this.timestamp.gameReadyToStart=(new Date).getTime(),this.tryStart()},j),B=function(){return(B=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},F=(H.prototype.init=function(e,t,n,r){q.init(e,t,n,r)},Object.defineProperty(H.prototype,"callback",{get:function(){return x},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"trigger",{get:function(){return G},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"utils",{get:function(){return{getUrlParams:a,eventPool:p}},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"status",{get:function(){return B({},i)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"metadata",{get:function(){return B({},o)},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"protocol",{get:function(){return{isViewable:function(){return T().isViewable()},getScreenSize:function(){return T().getScreenSize()},getAdData:function(){return T().getAdData()},getDeviceData:function(){return T().getDeviceData()},getAudioVolume:function(){return T().getAudioVolume()},triggerEvent:function(e){return T().triggerEvent(e)},open:function(e){return T().open(e)}}},enumerable:!0,configurable:!0}),Object.defineProperty(H.prototype,"event",{get:function(){return{send:function(e,t){return C.sendCustomEvent(e,t,i)}}},enumerable:!0,configurable:!0}),H);function H(){}window.NUC=new F}]);